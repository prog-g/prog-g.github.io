---
layout: post
title: "Windows PCにHDDを増設して安全にLinuxとデュアルブートする"
tag: [環境構築]
---

Windows が入っている PC で Linux を使用する方法はいろいろあるが、仮想環境でない実環境が必要になったときなど、デュアルブート環境を構築したくなることがある。
しかし、ひとつのディスクに複数の OS を入れよう（通常のデュアルブート）とするとブートローダーを改変することになるのでトラブルの原因になることがある。
そこで、新しいまっさらのディスクに Linux を入れて、 BIOS でブートデバイスを切り替えることで Windows と Linux の起動を切り替えるようにする。
それぞれの OS のブートローダーが独立して変更されないのでかなり安全にデュアルブート環境を構築できる。

## 通常のデュアルブートに比べて

### メリット

- 安全
- Windows 側での事前設定が皆無

### デメリット

- 新しいディスクを買う必要がある（場合によっては他のパーツも）
- PC の中を触る必要がある（ノート PC では厳しい）
- BIOS によってはデバイス選択画面がなく、デバイス切り替えのとき常に BIOS 設定に入る必要がありやや面倒

## 作業手順

### 1. 新しいディスクを取り付ける

空のディスクが必要なので購入するなどして用意する。
先に PC 内部で取り付け場所や必要なケーブルが余っているか確認しておくのが賢明。

![TOSHIBA HDD]({{ "/assets/2018/HDD.jpg" | relative_url }})

PC の空いているドライブベイにディスクを取り付けて、ケーブル（SATA, SATA 電源等）で接続する。
ドライブベイによってはラジオペンチなどの工具が必要。

終わったら Windows を起動してディスクが認識されているか確認する。

![Windowsディスクの管理画面]({{ "/assets/2018/Windowsディスクの管理.png" | relative_url }})

### 2. Linux イメージの作成

引き続き Windows で作業する。
OS の起動ディスクを作成するためにイメージファイルを入手する。
例えば日本語版 Ubuntu では [Ubuntu Desktop 日本語 Remix のダウンロード](https://www.ubuntulinux.jp/download/ja-remix) からダウンロードする。

[ImgBurn](http://www.imgburn.com/) などのソフトウェアを使って起動イメージを DVD などに焼いて作成する。
USB メモリでブートできるようにする方法もある。

イメージが焼けたらそのままドライブにセットしておいて PC を再起動。

### 3. Linux のインストール

再起動中に BIOS 画面で BIOS 設定またはブートデバイス選択画面を呼び出し Linux イメージの入ったデバイスが起動するようにする。

![BIOSブートデバイスメニューの例]({{ "/assets/2018/BIOSブートデバイスメニュー.png" | relative_url }})

Linux が起動するのでインストールウィザードに従ってインストールをする。
以下 Ubuntu を例に進める。

![Ubuntuインストールウィザード-はじめ]({{ "/assets/2018/Ubuntuインストール1.jpg" | relative_url }})

コンピュータの名前やタイムゾーンなどは普通にウィザードに従っていれば問題ない。

![Ubuntuインストールウィザード-ディスク]({{ "/assets/2018/Ubuntuインストール2.jpg" | relative_url }})

インストールの種類では必ず **「それ以外」** を選ぶ。
次の画面でブートローダーをインストールするデバイスに **「空のディスク」** を確実に選択し、パーティションを切る。

パーティションは「EFI システム」「スワップ」「ルート」の３つ切れば足りる。
EFI システムは 200MB もあれば十分。
スワップ領域は論理パーティションにして物理メモリの 1 〜 1.5 倍に設定する。
ルート（マウントポイント「_/_」）は ext4 で基本パーティションにして残りの部分を充てる。

インストールウィザードを最後まで進めてインストール完了まで待機し、完了後に PC を再起動する。

Ubuntu を起動して以下のような画面になれば完了。

![Ubuntuインストール完了画面]({{ "/assets/2018/Ubuntuインストール完了.png" | relative_url }})

### 4. Windows の起動を確認

PC を再起動して BIOS 画面で BIOS 設定またはブートデバイス選択画面を呼び出し、Windows の入ったデバイスでブートする。
Windows が起動すれば問題なし。

## 最初にしておくと良い設定

### Windows の時計がずれる問題

Windows はシステム時刻をローカル時間で扱うが Ubuntu は UTC で扱っており、 Ubuntu を起動したあとに Windows を起動すると時刻が 9 時間ずれる（日本時間の場合）。
Ubuntu が時刻をローカル時間で扱うように、以下のコマンドを Ubuntu で実行する。

```sh
sudo timedatectl set-local-rtc 1
```

これで次に時刻同期が走ったタイミングでズレは勝手に治る。
