---
layout: post
title: "Windows PCにHDDを増設して安全にLinuxとデュアルブートする"
tag: [ 環境構築 ]
---

Windowsが入っているPCでLinuxを使用する方法はいろいろあるが、仮想環境でない実環境が必要になったときなど、デュアルブート環境を構築したくなることがある。
しかし、１つのディスクに複数のOSを入れよう（通常のデュアルブート）とするとブートローダーを改変することになるのでトラブルの原因になることがある。
そこで、新しいまっさらのディスクにLinuxを入れて、BIOSでブートデバイスを切り替えることでWindowsとLinuxの起動を切り替えるようにする。
それぞれのOSのブートローダーが独立して変更されないのでかなり安全にデュアルブート環境を構築できる。

## 通常のデュアルブートに比べて
### メリット
- 安全
- Windows側での事前設定が皆無

### デメリット
- 新しいディスクを買う必要がある（場合によっては他のパーツも）
- PCの中を触る必要がある（ノートPCでは厳しい）
- BIOSによってはデバイス選択画面がなく、デバイス切り替えのとき常にBIOS設定に入る必要がありやや面倒

## 作業手順
### 1. 新しいディスクを取り付ける

空のディスクが必要なので購入するなどして用意する。先にPC内部で取り付け場所や必要なケーブルが余っているか確認しておくのが懸命。

![TOSHIBA HDD]({{ "/assets/2018/HDD.jpg" | relative_url }})

PCの空いているドライブベイにディスクを取り付けて、ケーブル（SATA、SATA電源等）で接続する。ドライブベイによってはラジオペンチなどの工具が必要。

終わったらWindowsを起動してディスクが認識されているか確認する。

![Windowsディスクの管理画面]({{ "/assets/2018/Windowsディスクの管理.png" | relative_url }})

### 2. Linuxイメージの作成

引き続きWindowsで作業する。OSの起動ディスクを作成するためにイメージファイルを入手する。例えば日本語版Ubuntuでは[Ubuntu Desktop 日本語 Remixのダウンロード](https://www.ubuntulinux.jp/download/ja-remix)からダウンロードする。

[ImgBurn](http://www.imgburn.com/)などのソフトウェアを使って起動イメージをDVDなどに焼いて作成する。USBメモリでブートできるようにする方法もある。

イメージが焼けたらそのままドライブにセットしておいてPCを再起動。

### 3. Linuxのインストール

再起動中にBIOS画面でBIOS設定またはブートデバイス選択画面を呼び出しLinuxイメージの入ったデバイスが起動するようにする。

![BIOSブートデバイスメニューの例]({{ "/assets/2018/BIOSブートデバイスメニュー.png" | relative_url }})

Linuxが起動するのでインストールウィザードに従ってインストールをする。以下Ubuntuを例に進める。

![Ubuntuインストールウィザード-はじめ]({{ "/assets/2018/Ubuntuインストール1.jpg" | relative_url }})

コンピュータの名前やタイムゾーンなどは普通にウィザードに従っていれば問題ない。

![Ubuntuインストールウィザード-ディスク]({{ "/assets/2018/Ubuntuインストール2.jpg" | relative_url }})

インストールの種類では**必ず「それ以外」を選ぶ。**次の画面でブートローダーをインストールするデバイスに**空のディスクを確実に選択**し、パーティションを切る。

パーティションは「EFIシステム」「スワップ」「ルート」の3つ切れば足りる。
EFIシステムは200MBもあれば十分。スワップ領域は論理パーティションにして物理メモリの1倍〜1.5倍に設定する。ルート（マウントポイント「/」）はext4で基本パーティションにして残りの部分を充てる。

インストールウィザードを最後まで進めてインストール完了まで待機し、完了後にPCを再起動する。

Ubuntuを起動して以下のような画面になれば完了。

![Ubuntuインストール完了画面]({{ "/assets/2018/Ubuntuインストール完了.png" | relative_url }})

### 4. Windowsの起動を確認

PCを再起動してBIOS画面でBIOS設定またはブートデバイス選択画面を呼び出し、Windowsの入ったデバイスでブートする。Windowsが起動すれば問題なし。

## 最初にしておくと良い設定
### Windowsと時計がずれる問題（Ubuntu）
Windowsはシステム時刻をローカル時間で扱うがUbuntuはUTCで扱っており、Ubuntuを起動したあとにWindowsを起動すると時刻が9時間ずれる（日本時間の場合）。
Ubuntuが時刻をローカル時間で扱うように以下のコマンドをUbuntuで実行する。
```sh
sudo timedatectl set-local-rtc 1
```

これで次に時刻同期が走ったタイミングでズレは勝手に治る。
